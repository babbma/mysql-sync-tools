# MySQL æ•°æ®åº“åŒæ­¥å·¥å…· - ç®€åŒ–é…ç½®ç‰ˆè¯´æ˜

## é…ç½®ç®€åŒ–è¯´æ˜

ä¸ºäº†ç®€åŒ–é…ç½®ï¼Œæ•°æ®åº“é…ç½®å·²ç®€åŒ–ä¸ºåªéœ€è¦ 3 ä¸ªå‚æ•°ï¼š

1. **url**: æ•°æ®åº“è¿æ¥åœ°å€ï¼ˆæ ¼å¼: `host:port/database`ï¼‰
2. **username**: æ•°æ®åº“ç”¨æˆ·å
3. **password**: æ•°æ®åº“å¯†ç 

## é…ç½®ç¤ºä¾‹

### åŸºæœ¬é…ç½®

```yaml
# æºæ•°æ®åº“é…ç½®
source:
  url: "192.168.1.100:3306/source_db"
  username: "root"
  password: "password123"

# ç›®æ ‡æ•°æ®åº“é…ç½®
target:
  url: "192.168.1.200:3306/target_db"
  username: "root"
  password: "password456"

# åŒæ­¥é…ç½®
sync:
  batch_size: 200
  truncate_before_sync: false
  exclude_tables: []
  include_tables: []
  timeout: 3600
  verbose: true

# æ—¥å¿—é…ç½®
log:
  level: "info"
  file: "sync.log"
  console: true
```

### URL æ ¼å¼è¯´æ˜

URL æ ¼å¼ä¸ºï¼š`host:port/database`

**ç¤ºä¾‹**ï¼š

1. **æœ¬åœ°æ•°æ®åº“**
   ```yaml
   url: "localhost:3306/mydb"
   url: "127.0.0.1:3306/mydb"
   ```

2. **è¿œç¨‹æ•°æ®åº“**
   ```yaml
   url: "192.168.1.100:3306/mydb"
   url: "db.example.com:3306/mydb"
   ```

3. **éæ ‡å‡†ç«¯å£**
   ```yaml
   url: "192.168.1.100:3307/mydb"
   ```

4. **é»˜è®¤ç«¯å£ï¼ˆ3306ï¼‰**
   ```yaml
   url: "192.168.1.100:3306/mydb"
   ```

## é…ç½®å¯¹æ¯”

### æ—§ç‰ˆé…ç½®ï¼ˆå¤æ‚ï¼‰

```yaml
source:
  host: "192.168.1.100"
  port: 3306
  username: "root"
  password: "password123"
  database: "source_db"
  charset: "utf8mb4"
```

### æ–°ç‰ˆé…ç½®ï¼ˆç®€åŒ–ï¼‰

```yaml
source:
  url: "192.168.1.100:3306/source_db"
  username: "root"
  password: "password123"
```

## å®Œæ•´é…ç½®ç¤ºä¾‹

### ç¤ºä¾‹ 1: æœ¬åœ°åˆ°æœ¬åœ°åŒæ­¥

```yaml
source:
  url: "localhost:3306/production_db"
  username: "root"
  password: "prod_pwd"

target:
  url: "localhost:3306/backup_db"
  username: "root"
  password: "backup_pwd"

sync:
  batch_size: 500
  truncate_before_sync: true
```

### ç¤ºä¾‹ 2: è¿œç¨‹åˆ°æœ¬åœ°åŒæ­¥

```yaml
source:
  url: "production.example.com:3306/app_db"
  username: "readonly_user"
  password: "safe_password"

target:
  url: "localhost:3306/dev_db"
  username: "root"
  password: "local_pwd"

sync:
  batch_size: 200
  truncate_before_sync: true
  exclude_tables:
    - "logs_*"
    - "temp_*"
```

### ç¤ºä¾‹ 3: è·¨åŒºåŸŸåŒæ­¥

```yaml
source:
  url: "10.1.1.100:3306/main_db"
  username: "sync_user"
  password: "sync_password"

target:
  url: "10.2.1.100:3306/backup_db"
  username: "sync_user"
  password: "sync_password"

sync:
  batch_size: 100  # è·¨åŒºåŸŸç½‘ç»œï¼Œä½¿ç”¨è¾ƒå°æ‰¹é‡
  truncate_before_sync: false
  timeout: 7200
```

### ç¤ºä¾‹ 4: Docker ç¯å¢ƒ

```yaml
source:
  url: "mysql-source:3306/app_db"  # Docker å®¹å™¨å
  username: "root"
  password: "mysql_root_pwd"

target:
  url: "mysql-target:3306/app_db"  # Docker å®¹å™¨å
  username: "root"
  password: "mysql_root_pwd"

sync:
  batch_size: 1000
  truncate_before_sync: true
```

## ä½¿ç”¨è¯´æ˜

### 1. åˆ›å»ºé…ç½®æ–‡ä»¶

```bash
cp config.example.yaml config.yaml
```

### 2. ç¼–è¾‘é…ç½®

åªéœ€ä¿®æ”¹ 3 ä¸ªæ ¸å¿ƒå‚æ•°ï¼š

```yaml
source:
  url: "ä½ çš„æºæ•°æ®åº“åœ°å€:ç«¯å£/æ•°æ®åº“å"
  username: "ä½ çš„ç”¨æˆ·å"
  password: "ä½ çš„å¯†ç "

target:
  url: "ä½ çš„ç›®æ ‡æ•°æ®åº“åœ°å€:ç«¯å£/æ•°æ®åº“å"
  username: "ä½ çš„ç”¨æˆ·å"
  password: "ä½ çš„å¯†ç "
```

### 3. è¿è¡ŒåŒæ­¥

```bash
# Windows
db-sync.exe -config config.yaml

# Linux/Mac
./db-sync -config config.yaml
```

## å¸¸è§é—®é¢˜

### Q: URL ä¸­çš„ç«¯å£å¯ä»¥çœç•¥å—ï¼Ÿ

A: ä¸å¯ä»¥ã€‚å¿…é¡»æ˜ç¡®æŒ‡å®šç«¯å£ï¼Œå³ä½¿æ˜¯é»˜è®¤çš„ 3306ã€‚

**æ­£ç¡®**ï¼š`localhost:3306/mydb`  
**é”™è¯¯**ï¼š`localhost/mydb`

### Q: æ•°æ®åº“åä¸­åŒ…å«ç‰¹æ®Šå­—ç¬¦æ€ä¹ˆåŠï¼Ÿ

A: URL ä¸­çš„æ•°æ®åº“åä¼šè‡ªåŠ¨å¤„ç†ï¼Œæ— éœ€é¢å¤–è½¬ä¹‰ã€‚

```yaml
url: "localhost:3306/my-db-name"  # æ­£ç¡®
url: "localhost:3306/my_db_name"  # æ­£ç¡®
```

### Q: æ”¯æŒ SSL è¿æ¥å—ï¼Ÿ

A: ç›®å‰é…ç½®é€šè¿‡ DSN è‡ªåŠ¨æ·»åŠ äº† `charset=utf8mb4&parseTime=True&loc=Local` å‚æ•°ã€‚å¦‚éœ€ SSLï¼Œå¯ä»¥ä¿®æ”¹æºä»£ç ä¸­çš„ `GetDSN()` æ–¹æ³•ã€‚

### Q: å¦‚ä½•è¿æ¥åˆ° IPv6 åœ°å€ï¼Ÿ

A: ä½¿ç”¨æ–¹æ‹¬å·åŒ…è£¹ IPv6 åœ°å€ï¼š

```yaml
url: "[2001:db8::1]:3306/mydb"
```

### Q: å¯†ç åŒ…å«ç‰¹æ®Šå­—ç¬¦æ€ä¹ˆåŠï¼Ÿ

A: å¯†ç å­—æ®µä½¿ç”¨ YAML å­—ç¬¦ä¸²æ ¼å¼ï¼Œç‰¹æ®Šå­—ç¬¦ä¼šè‡ªåŠ¨å¤„ç†ã€‚å¦‚æœå¯†ç ä¸­åŒ…å«å¼•å·ï¼Œä½¿ç”¨å•å¼•å·æˆ–è½¬ä¹‰ï¼š

```yaml
password: "pass@word#123"      # æ­£ç¡®
password: 'pass"word'          # åŒ…å«åŒå¼•å·
password: "pass\"word"         # è½¬ä¹‰åŒå¼•å·
```

## ä¼˜åŠ¿

ç®€åŒ–é…ç½®çš„ä¼˜åŠ¿ï¼š

1. âœ… **é…ç½®æ›´ç®€æ´**ï¼šä» 6 ä¸ªå‚æ•°å‡å°‘åˆ° 3 ä¸ª
2. âœ… **ä¸€ç›®äº†ç„¶**ï¼šURL æ ¼å¼æ¸…æ™°æ˜“æ‡‚
3. âœ… **æ˜“äºç®¡ç†**ï¼šä¾¿äºå¤åˆ¶å’Œä¿®æ”¹
4. âœ… **å‡å°‘é”™è¯¯**ï¼šæ›´å°‘çš„é…ç½®é¡¹æ„å‘³ç€æ›´å°‘çš„é…ç½®é”™è¯¯

## æŠ€æœ¯è¯´æ˜

### DSN ç”Ÿæˆ

å†…éƒ¨ä¼šå°†ç®€åŒ–é…ç½®è½¬æ¢ä¸º MySQL DSN æ ¼å¼ï¼š

```
é…ç½®: url="host:port/database", username="user", password="pwd"
è½¬æ¢ä¸º: user:pwd@tcp(host:port/database)?charset=utf8mb4&parseTime=True&loc=Local
```

### å­—ç¬¦é›†

é»˜è®¤ä½¿ç”¨ `utf8mb4` å­—ç¬¦é›†ï¼Œæ”¯æŒå®Œæ•´çš„ Unicode å­—ç¬¦ï¼ŒåŒ…æ‹¬ Emojiã€‚

### æ—¶åŒºå¤„ç†

é»˜è®¤ä½¿ç”¨æœ¬åœ°æ—¶åŒº (`loc=Local`)ï¼Œç¡®ä¿æ—¶é—´å­—æ®µæ­£ç¡®å¤„ç†ã€‚

## å¿«é€Ÿæ£€æŸ¥æ¸…å•

åœ¨è¿è¡ŒåŒæ­¥å‰ï¼Œè¯·æ£€æŸ¥ï¼š

- [ ] URL æ ¼å¼æ­£ç¡®ï¼ˆhost:port/databaseï¼‰
- [ ] ç”¨æˆ·åå’Œå¯†ç æ­£ç¡®
- [ ] æºæ•°æ®åº“å¯ä»¥è¿æ¥
- [ ] ç›®æ ‡æ•°æ®åº“å¯ä»¥è¿æ¥
- [ ] ç”¨æˆ·æœ‰è¶³å¤Ÿæƒé™ï¼ˆæºéœ€è¦ SELECTï¼Œç›®æ ‡éœ€è¦ INSERT, CREATE, DROPï¼‰
- [ ] ç½‘ç»œè¿é€šæ€§æ­£å¸¸
- [ ] batch_size è®¾ç½®åˆç†

## ç¤ºä¾‹å®Œæ•´é…ç½®æ–‡ä»¶

```yaml
# MySQL æ•°æ®åº“åŒæ­¥å·¥å…·é…ç½®æ–‡ä»¶ï¼ˆç®€åŒ–ç‰ˆï¼‰

# æºæ•°æ®åº“ï¼ˆæ•°æ®ä»è¿™é‡Œè¯»å–ï¼‰
source:
  url: "192.168.1.100:3306/production_db"
  username: "readonly_user"
  password: "safe_password"

# ç›®æ ‡æ•°æ®åº“ï¼ˆæ•°æ®å†™å…¥è¿™é‡Œï¼‰
target:
  url: "192.168.1.200:3306/backup_db"
  username: "write_user"
  password: "write_password"

# åŒæ­¥é…ç½®
sync:
  # æ¯æ‰¹æ¬¡å¤„ç†çš„è®°å½•æ•°ï¼ˆæ ¹æ®å¸¦å®½è°ƒæ•´ï¼‰
  batch_size: 200
  
  # æ˜¯å¦åœ¨åŒæ­¥å‰æ¸…ç©ºç›®æ ‡è¡¨
  truncate_before_sync: true
  
  # æ’é™¤çš„è¡¨ï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰
  exclude_tables:
    - "tmp_*"
    - "temp_*"
    - "cache_*"
  
  # åªåŒæ­¥è¿™äº›è¡¨ï¼ˆä¸ºç©ºåˆ™åŒæ­¥æ‰€æœ‰ï¼‰
  include_tables: []
  
  # è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
  timeout: 3600
  
  # è¯¦ç»†æ—¥å¿—
  verbose: true

# æ—¥å¿—é…ç½®
log:
  level: "info"        # debug, info, warn, error
  file: "sync.log"     # æ—¥å¿—æ–‡ä»¶è·¯å¾„
  console: true        # è¾“å‡ºåˆ°æ§åˆ¶å°
```

## è·å–å¸®åŠ©

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š

1. [README.md](README.md) - å®Œæ•´æ–‡æ¡£
2. [QUICKSTART.md](QUICKSTART.md) - å¿«é€Ÿå¼€å§‹
3. [EXAMPLES.md](EXAMPLES.md) - æ›´å¤šç¤ºä¾‹

æˆ–æäº¤ Issueï¼šhttps://github.com/yourusername/db-sync-tools/issues

---

**æ›´æ–°æ—¥æœŸ**: 2025-11-04  
**ç‰ˆæœ¬**: 1.0.0 (ç®€åŒ–é…ç½®ç‰ˆ)

Happy Syncing! ğŸš€

